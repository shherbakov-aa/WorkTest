# WorkTest
Веб-приложение для решения тестовых заданий.

Данное приложение работает с СУБД PostgreSQL. 
Настройки коннекта к базе и тексты запросов вынесены в класс Database в файле Database.java в виде статических переменных String.

В проекте создан каталог sql, содержащий файлы:
create tables.sql - создание таблиц
insert test values.sql - заполнение таблиц тестовыми данными

Приложение развертывается по пути http(s)://{server}:{port}/wtest/
При обращении к указанному адресу загружается страница index.html, содержащая ссылки на разделы:
/task1 - форма поиска для задачи 1 без авторизации пользователя
/task1_auth - форма поиска для задачи 1 с авторизацией
/task2_sendform - форма обратной связи для задачи 2
/task2_searchform - Форма поиска сообщений для задачи 2

В задаче 1 применяется form-based аутентификация JAAS.
Для работы страницы task1_auth нужно в настройках веб-сервера Tomcat прописать роль task1AuthRole и привязать к ней пользователей.
Для этого надо в файле tomcat-users.xml прописать:
<role rolename="task1AuthRole"/>
<user username="user1" password="111" roles="task1AuthRole"/>
<user username="user2" password="222" roles="task1AuthRole"/>
<user username="user3" password="333" roles=""/>

Поскольку авторизация данным механизмом подразумевает передачу только двух параметров j_username и j_password по адресу j_security_check, то передача признака "Запомнить меня" была реализована при помощи Cookie.
Для этого на форме ввода логина и пароля, если снята галочка "Запомнить", создается запись Cookie "task1FlushSession=1".
После загрузки формы поиска по адресу task1_auth браузер при помощи JavaScript смотрит данное значение и, ессли оно установлено, сбрасывает сессию ajax-вызовом страницы logout.jsp.
Сервисы на форме поиска вызываются в ассинхронном режиме при помощи ajax без перезагрузки страницы и работают без авторизации, поэтому они будут продолжать вызываться, пока форма не будет обновлена.
После следующего открытия формы потребуется заново авторизоваться, т.к. старая сессия была сброшена.
Если галочка "Запомнить" была установлена, то никаких действий не требуется, запись Cookie не создается, т.к. пользователь будет авторизован пока активна данная сессия.

В задаче 2 механизм авторизации отличается. Пользователи авторизуются с учетными записями, записанными в таблице weblogins.
После успешной авторизации приложение сохраняет в эту таблицу в поле jsessionid значение идентификатора текущей сессии для данного пользователя.
При обращении к защищенным страницам приложение по id сессии ищет пользователя в БД. Если находит, то отображает содержимое, если нет, то редиректит на страницу ввода логина и пароля.

При разработке использовались следующие версии программных продуктов: 
Apache Tomcat/9.0.8
Java 1.8.0_171-b11
Apache Maven 3.5.4
PostgreSQL 9.5.0
Eclipse IDE for Java Developers Oxygen.3a Release (4.7.3a)
Git-2.18.0-64-bit
